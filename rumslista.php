<?phpinclude ("config-connect.php");?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head>	<title>Rumslista</title>	<meta charset="utf-8"> 	<style> @media print {    .page-break	{ display: block; page-break-before: always; }        .no-print, .no-print *    {        display: none !important;    }    .noborder	{ border-color:transparent; }  }  @page {    size:8.27in 11.69in;     margin:20mm;     mso-header-margin:0mm;      mso-footer-margin:0mm;     mso-paper-source:1;  }  </style>	</head><body style="padding:7px;"><form action="rumslista.php?resaid=<?php echo $_GET["resaid"] ?>&excel=true" method="post"><div class="no-print" align="center"><input class="no-print" type="submit" value="Excelformat">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input class="no-print" type="button" value="Skriv ut" onclick="window.print()"></div><table><?php	$boendealtArr = array();$reserveradeArr = array();     $sql = "SELECT * FROM Resor WHERE resaid=" . $_GET["resaid"];             if ($result = sqlsrv_query($conn, $sql, array(), array( "Scrollable" => SQLSRV_CURSOR_KEYSET ))) {        if (sqlsrv_num_rows($result) > 0) {        $row = sqlsrv_fetch_array($result, SQLSRV_FETCH_ASSOC );        $resanamn = $row["resa"];        $boendealtArr[0] = $row["boendealt1"];        $reserveradeArr[0] = $row["reserverade1"];        $boendealtArr[1] = $row["boendealt2"];        $reserveradeArr[1] = $row["reserverade2"];        $boendealtArr[2] = $row["boendealt3"];        $reserveradeArr[2] = $row["reserverade3"];        $boendealtArr[3] = $row["boendealt4"];        $reserveradeArr[3] = $row["reserverade4"];        $boendealtArr[4] = $row["boendealt5"];        $reserveradeArr[4] = $row["reserverade5"];        }      echo "<tr><td colspan='4'><big><b>Rumslista " . $resanamn . "</b></big></td></tr>";     }          if ($_GET["excel"]=="true") {        $onskemalarr=$_POST["onskemal"];             }                 $sql = "SELECT *,REPLACE(onskemal, CHAR(13) + CHAR(10), ', ') AS onskemal FROM Bokningar INNER JOIN Resenarer ON Bokningar.bokningid = Resenarer.bokningid WHERE Bokningar.resaid=" . $_GET["resaid"] . " AND makulerad='false' ORDER BY boendealt, Resenarer.bokningid, bekraftelse";             $avresa="0";      $antal=0;      $x=0;      $printedrows=0;      $ionskemal=0;      $persperrum=0;            $bektemp=0;            if ($result = sqlsrv_query($conn, $sql, array(), array( "Scrollable" => SQLSRV_CURSOR_KEYSET ))) {                      if (sqlsrv_num_rows($result) > 0) {                while ($row = sqlsrv_fetch_array($result, SQLSRV_FETCH_ASSOC )) {                                                if ($avresa!=$row["boendealt"] AND $x!=0) {                                    $arr = 0;                  for ($arri=0;$arri<=4;$arri++) {                   if ($avresa == $boendealtArr[$arri])                    $arr = $arri;                  }                                                      for ($arri=0;$arri<$reserveradeArr[$arr];$arri++) {                  echo "<tr><td nowrap style='padding-right: 10px;'>RESERVERAT</td><td nowrap style='padding-right: 10px;'>1st " . $boendealtArr[$arr] . "</td><td></td></tr>";                  }                                                      echo "<tr><td colspan='3'><b>Totalt " . (ceil(($antal/$persperrum)) + $reserveradeArr[$arr]) . " " . $avresa . "</b></td></tr><tr><td colspan='3'>&nbsp;</td></tr>";                  $printedrows++;                  $printedrows++;                  }                                                      if ($avresa!=$row["boendealt"]) {                  if (($printedrows > 26) AND (sqlsrv_num_rows($result) > 36)) {                    echo "</table><table class='page-break'>";                    }                                    $antal=0;                                                        }                                                                $boendealt = $row["boendealt"];                                if ($x!=0 AND $row["bokningid"]==$bektemp)                    $boendealt = "&quot;";                                    $boendepre = "";                                if (($row["antalresande"]/$row["persperrum"]) != 1)                  $boendepre = (ceil($row["antalresande"]/$row["persperrum"])) . "st ";                                if ($boendealt == "&quot;")                  $boendepre = "";                                                    if ($_GET["excel"]!="true")                  echo "<tr><td nowrap style='padding-right: 10px;'>" . $row["fornamn"] . " " . $row["efternamn"] . "</td><td nowrap style='padding-right: 10px;'>" . $boendepre . $boendealt . "</td><td><input type='text' class='noborder' name='onskemal[]' value='" . $row["onskemal"] . "' size=40></td></tr>";                else                  echo "<tr><td nowrap style='padding-right: 10px;'>" . $row["fornamn"] . " " . $row["efternamn"] . "</td><td nowrap style='padding-right: 10px;'>" . $boendepre . $boendealt . "</td><td>" . $onskemalarr[$ionskemal] . "</td></tr>";                $ionskemal++;                $printedrows++;                                                                               $persperrum=$row["persperrum"];                $avresa=$row["boendealt"];                 $antal++;                $x++;                $bektemp = $row["bokningid"];                                }                              $arr = 0;                  for ($arri=0;$arri<=4;$arri++) {                   if ($avresa == $boendealtArr[$arri])                    $arr = $arri;                  }                                                      for ($arri=0;$arri<$reserveradeArr[$arr];$arri++) {                                    echo "<tr><td nowrap style='padding-right: 10px;'>RESERVERAT</td><td nowrap style='padding-right: 10px;'>1st " . $boendealtArr[$arr] . "</td><td></td></tr>";                  }                             echo "<tr><td colspan='3'><b>Totalt " . (ceil(($antal/$persperrum)) + $reserveradeArr[$arr]) . " " . $avresa . "</b></td></tr>";              echo "<tr><td colspan='3'>&nbsp;</td></tr>";              $printedrows++;              $printedrows++;              } else {              echo "Inga resultat";              }              } else {              echo ( print_r("Kritiskt databasfel"));              die( print_r( sqlsrv_errors(), true));              }                                    ?>	   </table></form></body></html><?php   	  sqlsrv_close;?> 